# å¼ å®¶ç•…Goåç«¯è¿æ¥ä»»åŠ¡æ¸…å•

**ğŸ“… æ›´æ–°æ—¶é—´**: 2025å¹´9æœˆ16æ—¥ 22:30

1. **æ•°æ®åº“è¿æ¥æµ‹è¯•**

```bash
   cd /Users/zzw4257/Documents/ZJU_archieve/05.è¯¾ç¨‹ä¸å­¦æœ¯èµ„æ–™/åŒºå—é“¾/é‡æ¥/backend

   # è®¾ç½®æ•°æ®åº“è¿æ¥
   export DATABASE_URL="postgres://ä½ çš„ç”¨æˆ·å:ä½ çš„å¯†ç @localhost/desci?sslmode=disable"

   # è¿è¡Œå®Œæ•´ç‰ˆæœåŠ¡å™¨
   go run cmd/server/main.go

   # æœŸæœ›çœ‹åˆ°ï¼š
   # âœ… Database connected successfully
   # âœ… Demo data created successfully
```

2. **éªŒè¯Repository CRUDæ“ä½œ**

   ```bash
   # è¿è¡Œåæ£€æŸ¥æ•°æ®åº“ä¸­æ˜¯å¦æœ‰æ¼”ç¤ºæ•°æ®
   psql -d desci -c "SELECT * FROM research_data;"
   psql -d desci -c "SELECT * FROM dataset_records;"
   psql -d desci -c "SELECT * FROM event_logs;"
   ```

---

1. **Repositoryå±‚æµ‹è¯•** - `internal/repository/repo_test.go`

```go
   package repository

   import (
       "testing"
       "desci-backend/internal/model"
   )

   func TestInsertResearchData(t *testing.T) {
       // æµ‹è¯•æ’å…¥ç ”ç©¶æ•°æ®
   }

   func TestGetResearchData(t *testing.T) {
       // æµ‹è¯•æŸ¥è¯¢ç ”ç©¶æ•°æ®
   }

   func TestInsertDatasetRecord(t *testing.T) {
       // æµ‹è¯•æ’å…¥æ•°æ®é›†
   }

   func TestGetDatasetRecord(t *testing.T) {
       // æµ‹è¯•æŸ¥è¯¢æ•°æ®é›†
   }

   func TestInsertEventLog(t *testing.T) {
       // æµ‹è¯•äº‹ä»¶æ—¥å¿—æ’å…¥
   }
```

2. **Serviceå±‚æµ‹è¯•** - `internal/service/service_test.go`

   ```go
   package service

   import (
       "testing"
   )

   func TestProcessEvent(t *testing.T) {
       // æµ‹è¯•äº‹ä»¶å¤„ç†
   }

   func TestVerifyResearchContent(t *testing.T) {
       // æµ‹è¯•å†…å®¹éªŒè¯
   }

   func TestGetResearchByTokenID(t *testing.T) {
       // æµ‹è¯•æ ¹æ®TokenIDè·å–ç ”ç©¶æ•°æ®
   }

   func TestGetDatasetByID(t *testing.T) {
       // æµ‹è¯•æ ¹æ®IDè·å–æ•°æ®é›†
   }
   ```
3. **APIå±‚æµ‹è¯•** - `internal/api/router_test.go`

   ```go
   package api

   import (
       "net/http"
       "net/http/httptest"
       "testing"
       "github.com/gin-gonic/gin"
   )

   func TestHealthCheck(t *testing.T) {
       // æµ‹è¯•å¥åº·æ£€æŸ¥ç«¯ç‚¹
   }

   func TestGetResearch(t *testing.T) {
       // æµ‹è¯•è·å–ç ”ç©¶æ•°æ®ç«¯ç‚¹
   }

   func TestGetDataset(t *testing.T) {
       // æµ‹è¯•è·å–æ•°æ®é›†ç«¯ç‚¹
   }

   func TestVerifyResearch(t *testing.T) {
       // æµ‹è¯•éªŒè¯ç ”ç©¶å†…å®¹ç«¯ç‚¹
   }
   ```
4. **é›†æˆæµ‹è¯•** - `test/integration_test.go`

   ```go
   package test

   import (
       "testing"
   )

   func TestEndToEnd(t *testing.T) {
       // ç«¯åˆ°ç«¯æµ‹è¯•ï¼šæ•°æ®åº“ â†’ Service â†’ API
   }

   func TestDatabaseIntegration(t *testing.T) {
       // æ•°æ®åº“é›†æˆæµ‹è¯•
   }
   ```

---

## ğŸ” **éªŒè¯æ­¥éª¤**

### 1. è¿è¡Œæ‰€æœ‰æµ‹è¯•

```bash
cd backend
go test ./...
```

**æœŸæœ›ç»“æœ**: æ‰€æœ‰æµ‹è¯•é€šè¿‡

### 2. æ£€æŸ¥æµ‹è¯•è¦†ç›–ç‡

```bash
go test -coverprofile=coverage.out ./...
go tool cover -html=coverage.out
```

**æœŸæœ›ç»“æœ**: è¦†ç›–ç‡ >= 80%

### 3. éªŒè¯æ•°æ®åº“æ“ä½œ

```bash
# å¯åŠ¨æœåŠ¡å™¨
go run cmd/server/main.go

# åœ¨å¦ä¸€ä¸ªç»ˆç«¯æµ‹è¯•API
curl http://localhost:8080/api/v1/research/demo-token-123
curl http://localhost:8080/api/v1/dataset/dataset-456
```

---

## ğŸ“Š **å½“å‰ä»£ç çŠ¶æ€åˆ†æ**

### âœ… å‘¨å­ä¸ºå·²å®Œæˆï¼ˆ100%ï¼‰ï¼š

- APIè·¯ç”±å’Œå¤„ç†å™¨
- Serviceä¸šåŠ¡é€»è¾‘å±‚
- åŒºå—é“¾äº‹ä»¶ç›‘å¬å™¨
- å®Œæ•´çš„åˆ†å±‚æ¶æ„
- æ¼”ç¤ºæœåŠ¡å™¨ï¼ˆå¯ç«‹å³ä½¿ç”¨ï¼‰
- æ‰€æœ‰æ¥å£å®šä¹‰

### âš ï¸ å¼ å®¶ç•…éœ€è¦å®Œæˆï¼š

- Repositoryå±‚çš„æµ‹è¯•éªŒè¯
- æ•°æ®åº“è¿æ¥çš„å®é™…æµ‹è¯•
- æ‰€æœ‰æµ‹è¯•æ–‡ä»¶ï¼ˆå½“å‰0ä¸ªï¼‰
- æµ‹è¯•è¦†ç›–ç‡ä»0%æå‡åˆ°80%

## ğŸš€ **å¿«é€Ÿå¼€å§‹æŒ‡å—**

1. **æ£€æŸ¥ç¯å¢ƒ**:

   ```bash
   go version  # ç¡®ä¿Goå·²å®‰è£…
   psql --version  # ç¡®ä¿PostgreSQLå·²å®‰è£…
   ```
2. **å¯åŠ¨æ•°æ®åº“**:

   ```bash
   # å¯åŠ¨PostgreSQLæœåŠ¡
   # åˆ›å»ºdesciæ•°æ®åº“ï¼ˆå¦‚æœè¿˜æ²¡æœ‰ï¼‰
   createdb desci
   ```
3. **æµ‹è¯•ç°æœ‰åŠŸèƒ½**:

   ```bash
   cd backend
   go run cmd/server/main_stdlib.go  # å¯åŠ¨æ¼”ç¤ºæœåŠ¡å™¨
   # åœ¨å¦ä¸€ä¸ªç»ˆç«¯æµ‹è¯•API
   curl http://localhost:8081/health
   ```
4. **å¼€å§‹ä½ çš„å·¥ä½œ**:

   ```bash
   # åˆ›å»ºç¬¬ä¸€ä¸ªæµ‹è¯•æ–‡ä»¶
   touch internal/repository/repo_test.go
   # å¼€å§‹ç¼–å†™æµ‹è¯•
   ```
