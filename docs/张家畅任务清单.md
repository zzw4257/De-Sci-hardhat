# 张家畅Go后端连接任务清单

**📅 更新时间**: 2025年9月16日 22:30

1. **数据库连接测试**

```bash
   cd /Users/zzw4257/Documents/ZJU_archieve/05.课程与学术资料/区块链/重来/backend

   # 设置数据库连接
   export DATABASE_URL="postgres://你的用户名:你的密码@localhost/desci?sslmode=disable"

   # 运行完整版服务器
   go run cmd/server/main.go

   # 期望看到：
   # ✅ Database connected successfully
   # ✅ Demo data created successfully
```

2. **验证Repository CRUD操作**

   ```bash
   # 运行后检查数据库中是否有演示数据
   psql -d desci -c "SELECT * FROM research_data;"
   psql -d desci -c "SELECT * FROM dataset_records;"
   psql -d desci -c "SELECT * FROM event_logs;"
   ```

---

1. **Repository层测试** - `internal/repository/repo_test.go`

```go
   package repository

   import (
       "testing"
       "desci-backend/internal/model"
   )

   func TestInsertResearchData(t *testing.T) {
       // 测试插入研究数据
   }

   func TestGetResearchData(t *testing.T) {
       // 测试查询研究数据
   }

   func TestInsertDatasetRecord(t *testing.T) {
       // 测试插入数据集
   }

   func TestGetDatasetRecord(t *testing.T) {
       // 测试查询数据集
   }

   func TestInsertEventLog(t *testing.T) {
       // 测试事件日志插入
   }
```

2. **Service层测试** - `internal/service/service_test.go`

   ```go
   package service

   import (
       "testing"
   )

   func TestProcessEvent(t *testing.T) {
       // 测试事件处理
   }

   func TestVerifyResearchContent(t *testing.T) {
       // 测试内容验证
   }

   func TestGetResearchByTokenID(t *testing.T) {
       // 测试根据TokenID获取研究数据
   }

   func TestGetDatasetByID(t *testing.T) {
       // 测试根据ID获取数据集
   }
   ```
3. **API层测试** - `internal/api/router_test.go`

   ```go
   package api

   import (
       "net/http"
       "net/http/httptest"
       "testing"
       "github.com/gin-gonic/gin"
   )

   func TestHealthCheck(t *testing.T) {
       // 测试健康检查端点
   }

   func TestGetResearch(t *testing.T) {
       // 测试获取研究数据端点
   }

   func TestGetDataset(t *testing.T) {
       // 测试获取数据集端点
   }

   func TestVerifyResearch(t *testing.T) {
       // 测试验证研究内容端点
   }
   ```
4. **集成测试** - `test/integration_test.go`

   ```go
   package test

   import (
       "testing"
   )

   func TestEndToEnd(t *testing.T) {
       // 端到端测试：数据库 → Service → API
   }

   func TestDatabaseIntegration(t *testing.T) {
       // 数据库集成测试
   }
   ```

---

## 🔍 **验证步骤**

### 1. 运行所有测试

```bash
cd backend
go test ./...
```

**期望结果**: 所有测试通过

### 2. 检查测试覆盖率

```bash
go test -coverprofile=coverage.out ./...
go tool cover -html=coverage.out
```

**期望结果**: 覆盖率 >= 80%

### 3. 验证数据库操作

```bash
# 启动服务器
go run cmd/server/main.go

# 在另一个终端测试API
curl http://localhost:8080/api/v1/research/demo-token-123
curl http://localhost:8080/api/v1/dataset/dataset-456
```

---

## 📊 **当前代码状态分析**

### ✅ 周子为已完成（100%）：

- API路由和处理器
- Service业务逻辑层
- 区块链事件监听器
- 完整的分层架构
- 演示服务器（可立即使用）
- 所有接口定义

### ⚠️ 张家畅需要完成：

- Repository层的测试验证
- 数据库连接的实际测试
- 所有测试文件（当前0个）
- 测试覆盖率从0%提升到80%

## 🚀 **快速开始指南**

1. **检查环境**:

   ```bash
   go version  # 确保Go已安装
   psql --version  # 确保PostgreSQL已安装
   ```
2. **启动数据库**:

   ```bash
   # 启动PostgreSQL服务
   # 创建desci数据库（如果还没有）
   createdb desci
   ```
3. **测试现有功能**:

   ```bash
   cd backend
   go run cmd/server/main_stdlib.go  # 启动演示服务器
   # 在另一个终端测试API
   curl http://localhost:8081/health
   ```
4. **开始你的工作**:

   ```bash
   # 创建第一个测试文件
   touch internal/repository/repo_test.go
   # 开始编写测试
   ```
